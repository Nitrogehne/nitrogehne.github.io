<article id="pokemongo">
    <h3>완벽 포켓몬 수집을 목표로 하고있습니다.</h3>
    <div class="flex">
        <table id="pokemongo_tb">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>
    <img alt="Floating Image" id="floating_image" />
</article>
<link rel="stylesheet" href="${path}/style.css" />
<script src="${path}/pokemon_names.js"></script>
<script src="${path}/perfect_pokemons.js"></script>
<script>
    var test = 0;
    var table_title = ["사탕 그룹", "도감 번호", "모습", "특별한 기술", "기타"];
    var thead = $("#pokemongo_tb thead");
    for (let title of table_title) {
        let th = $("<th>");
        th.html(title);
        thead.append(th);
    }
    var tbody = $("#pokemongo_tb tbody");
    var icon = $("<div>").addClass("icon");
    var txt = $("<div>").addClass("txt");
    var odd = false;
    var candy_group_tr;
    var candy_group_rowspan;
    for (let obj of perfect_pokemons) {
        if (test) console.log(obj);
        let tr = $("<tr>");
        tbody.append(tr);
        for (let title of table_title) {
            let td = $("<td>");
            tr.append(td);
            switch (title) {
                case "사탕 그룹":
                    if (obj["candy_group"]) {
                        candy_group_tr = tr;
                        candy_group_rowspan = 1;
                        odd = !odd;
                        td.html(obj["candy_group"]).attr(
                            "data-title",
                            "candy_group"
                        );
                        candy_group_tr.addClass("candy_group_first");
                    } else {
                        candy_group_tr
                            .find("td[data-title=candy_group]")
                            .attr("rowspan", ++candy_group_rowspan);
                        td.remove();
                    }
                    if (!odd) tr.addClass("odd");
                    break;
                case "도감 번호":
                    if (obj.hasOwnProperty("pokedex_no") && obj["pokedex_no"]) {
                        td.html(obj["pokedex_no"]);
                    }
                    break;
                case "모습":
                    if (obj["shiny"]) {
                        td.append(icon.clone().addClass("shiny"));
                    }
                    if (obj["shadow"]) {
                        td.append(icon.clone().addClass("shadow"));
                    }
                    if (obj["purified"]) {
                        td.append(icon.clone().addClass("purified"));
                    }
                    if (obj["costume"]) {
                        td.append(
                            txt
                                .clone()
                                .addClass("hover")
                                .attr("data-img_url", obj["image"])
                                .html(obj["costume"])
                        );
                    }
                    if (obj["region"]) {
                        let region = "";
                        switch (obj["region"]) {
                            case "a":
                                region = "알로라";
                                break;
                            case "g":
                                region = "가라르";
                                break;
                            case "h":
                                region = "히스이";
                                break;
                        }
                        td.append(txt.clone().html(region));
                    }
                    if (obj["name"]) {
                        td.append(txt.clone().html(obj.name));
                    } else if (
                        obj["pokedex_no"] &&
                        pokemon_names[obj["pokedex_no"]]
                    ) {
                        td.append(
                            txt
                                .clone()
                                .html(pokemon_names[obj["pokedex_no"]][0])
                        );
                    }
                    switch (obj.sex) {
                        case "m":
                            td.append(txt.clone().html("♂"));
                            break;
                        case "f":
                            td.append(txt.clone().html("♀"));
                            break;
                    }
                    break;
                case "특별한 기술":
                    if (obj["knows_attack"]) {
                        td.append(txt.clone().html(obj["knows_attack"]));
                    }
                    break;
                case "기타":
                    if (obj["meet"]) {
                        td.append(icon.clone().addClass("meet_" + obj["meet"]));
                    }
                    if (obj["ball"]) {
                        td.append(icon.clone().addClass("ball_" + obj["ball"]));
                    }
                    if (obj["trade_date"]) {
                        td.append(icon.clone().addClass("trade"));
                    }
                    break;
            }
            if (obj["lucky"]) {
                tr.addClass("lucky");
            }
        }
    }

    $(document)
        .on("mouseover", ".hover[data-img_url]", function (e) {
            let img_url = $(this).attr("data-img_url");
            if (img_url) {
                $("#floating_image").css("display", "block");
                img_url = "${path}/img/" + img_url;
                updateFloatingImagePosition(img_url, e);
            }
        })
        .on("mousemove", ".hover[data-img_url]", function (e) {
            let img_url = $(this).attr("data-img_url");
            if (img_url) {
                img_url = "${path}/img/" + img_url;
                updateFloatingImagePosition(img_url, e);
            }
        })
        .on("mouseout", ".hover[data-img_url]", function (e) {
            let img_url = $(this).attr("data-img_url");
            if (img_url) {
                $("#floating_image").css("display", "none");
            }
        });
    function updateFloatingImagePosition(img_url, e) {
        $("#floating_image").attr("src", img_url);
        $("#floating_image").css("left", e.clientX + "px");
        $("#floating_image").css("top", e.clientY + "px");
    }
</script>
