<style>
    /* - - - - - - - - - - 조합판 */
    :root{
        --color-true : #1DDB16;
        --color-false : #FF0000;
        --color-select : #FFFF24;
        --color-border : silver;
        --rv : max(150px, min(calc(100vw / 7), calc(100vh / 6)));
        --rm : calc(var(--rv) / 6);
        --rb : calc(var(--rm) / 4);
        --rb2 : calc(var(--rb) / 2);
    }
    ._combiboard {
        display: inline-block;
        vertical-align: middle;
        margin-right : var(--rm);
    }
    ._combi {
        border: solid var(--color-border);
        border-width: var(--rb2) var(--rb2) 0px var(--rb2);
        font-size: calc((var(--rv) * 3) / 13 - var(--rb2) * 3);
        padding-left : var(--rm);
        letter-spacing: var(--rm);
        font-weight: bold;
        width: var(--rv);
        height: calc((var(--rv) * 3) / 13);
        text-align: center;
        vertical-align: middle;
        line-height: calc((var(--rv) * 3) / 13 - var(--rb2) * 2);
    }
    ._combi._a {
        color: var(--color-true);
    }
    ._combi._m {
        color: var(--color-fals)
    }
    ._comp {
        border-bottom-width: var(--rb2);
        color : var(--color-select);
        cursor: pointer;
    }
    ._comp:hover {
      border-color : var(--color-select);
    }
    ._comp._a {
        border-color : var(--color-true);
        color: var(--color-true);
    }
    ._comp._m {
        border-color : var(--color-fals)
        color: var(--color-fals)
    }
    /* - - - - - - - - - - 게임판 */
    ._gameboard {
        border: var(--rb) outset var(--color-border);
        display: inline-block;
        vertical-align: middle;
    }
    ._num {
        width: calc(var(--rv) / 4);
        height: calc(var(--rv) / 4);
        font-size: calc(var(--rv) / 4 - var(--rb2) * 3);
        font-weight: bold;
        position: absolute;
        margin: calc(-1 * var(--rv) / 4 / 2 - var(--rb2));
        background: black;
        border: var(--rb2) solid var(--color-border);
        border-radius: calc(var(--rv) / 4 / 2);
        text-align: center;
        vertical-align : middle;
        line-height: calc(var(--rv) / 4 - var(--rb2) * 2);
    }
    ._x {
        border: var(--rb) outset var(--color-border);
        margin: var(--rm) 0 0 var(--rm);
        cursor: pointer;
        width: var(--rv);
        height: var(--rv);
    }
    ._x:last-child {
        margin: var(--rm);
    }
    ._x._selected {
        border-color: var(--color-select);
    }
    ._x._a {
        border-color: var(--color-true);
    }
    ._x._m {
        border-color: var(--color-fals)
    }
    ._l {
        float: left;
    }
    ._cl {
        clear: both;
    }
    /* - - - - - - - - - - 배경 */
    ._w {
        background: white;
    }
    ._g {
        background: gray;
    }
    ._k {
        background: black;
    }
    /* - - - - - - - - - - 모양 */
    ._shape {
        
    }
    ._s { /* square */
        width: 0px;
        height: 0px;
        border-width: calc(var(--rv) / 2 - var(--rm) - var(--rb));
        border-style: solid;
        position : relative;
        left : var(--rm);
        top : var(--rm);
    }
    ._c { /* circle */
        width: 0px;
        height: 0px;
        border-width: calc(var(--rv) / 2 - var(--rm));
        border-radius: calc(var(--rv) / 2 - var(--rm));
        border-style: solid;
        position : relative;
        left : calc(var(--rm) - var(--rb));
        top :calc(var(--rm) - var(--rb));
    }
    ._t { /* triangle */
        width: 0px;
        height: 0px;
        border-top-width: 0;
        border-right-width: calc((var(--rv) / 2 - var(--rm)));
        border-bottom-width: calc(0.866 * (var(--rv) / 2 - var(--rm)) * 2);
        border-left-width: calc((var(--rv) / 2 - var(--rm)));
        border-style: solid;
        position : relative;
        left :calc(var(--rm) - var(--rb));
        top : var(--rm);
    }
    ._w ._t {
        border-top-color: white;
        border-right-color: white;
        border-left-color: white;
    }
    ._g ._t {
        border-top-color: gray;
        border-right-color: gray;
        border-left-color: gray;
    }
    ._k ._t {
        border-top-color: black;
        border-right-color: black;
        border-left-color: black;
    }
    /* - - - - - - - - - - 색 */
    ._r {
        border-color: #982525;
    }
    ._y {
        border-color: #DFAB00;
    }
    ._b {
        border-color: #2054DF;
    }


</style>
<article id="combination">
    <h1>결<span class="hidden">(缺)</span>! 합<span class="hidden">(合)</span>!</h1>
    <div class="_combiboard">
        <div class="_combi"></div>
        <div class="_combi"></div>
        <div class="_combi"></div>
        <div class="_combi"></div>
        <div class="_combi"></div>
        <div class="_combi"></div>
        <div class="_combi"></div>
        <div class="_combi"></div>
        <div class="_combi"></div>
        <div class="_combi"></div>
        <div class="_combi"></div>
        <div class="_combi"></div>
        <div class="_combi _comp">
            결!
        </div>
    </div>
    <div class="_gameboard">
        <div class="_x _l">
            <div class="_num">
                1
            </div>
            <div class="_shape"></div>
        </div>
        <div class="_x _l">
            <div class="_num">
                2
            </div>
            <div class="_shape"></div>
        </div>
        <div class="_x _l">
            <div class="_num">
                3
            </div>
            <div class="_shape"></div>
        </div>
        <div class="_x _cl _l">
            <div class="_num">
                4
            </div>
            <div class="_shape"></div>
        </div>
        <div class="_x _l">
            <div class="_num">
                5
            </div>
            <div class="_shape"></div>
        </div>
        <div class="_x _l">
            <div class="_num">
                6
            </div>
            <div class="_shape"></div>
        </div>
        <div class="_x _cl _l">
            <div class="_num">
                7
            </div>
            <div class="_shape"></div>
        </div>
        <div class="_x _l">
            <div class="_num">
                8
            </div>
            <div class="_shape"></div>
        </div>
        <div class="_x _l">
            <div class="_num">
                9
            </div>
            <div class="_shape"></div>
        </div>
    </div>
    <div class="test"></div>
</section>
<script>
	$(document).ready(function() {
		// 합!
		var answer = new Array();
		// 각 블럭에 조합 부여하기
		make_game(answer);
		$("._x").click(function() {
			var comp = false;
			// 블럭 클릭 이벤트
			// 3개 이하 선택시 클릭 가능.
			// 합! 이후 바로 클릭 못하도록 필요.
			if($("._selected").length < 3) {
				// 클릭하면 선택, 해제됨.
				$(this).toggleClass("_selected");
				// 3개를 선택하면 합! 이벤트 발생
				if($("._selected").length == 3) {
					// 합!이 남아있는 경우
					var combi = "";
					if(answer.length > 0) {
						// 셀렉트된 3개의 합을 찾는다.
						for(var i = 0; i < $("._selected").length; i++) {
							combi += $("._selected").eq(i).index() + 1;
						}
						for(var i = 0; i < answer.length; i++) {
							if(answer[i] == combi) {
								answer.splice(i, 1);
								$("._combi:empty").eq(0).attr("data-value", combi).addClass("_a").text(combi);
								$("._selected").addClass("_a");
								comp = true;
								break;
							}
						}
					}
					if(!comp) {
						$("._combi[data-value=" + combi + "]").addClass("_m");
						$("._selected").addClass("_m");
					}
					clear();
				}
			}
		});
		// 결! 이벤트
		$("._comp").click(function() {
			if($("._selected").length != 3) {
				if(answer.length > 0) {
                                       $("._comp").addClass("_m");
					$("._x").addClass("_selected _m");
					clear();
				} else {
                                       $("._comp").addClass("_a");
					$("._x").addClass("_selected _a");
					setTimeout(function() {
						make_game(answer);
					}, 1000);
				}
			}
		});
	});
	function make_game(answer) {
		$("._combi:not(._comp)").attr("data-value", "").text("");
               $("._comp").removeClass("_a _m");
		$("._selected").removeClass("_a _m _selected");
		// 조합 클래스명
		var wgk = new Array("_w", "_g", "_k");
		var tsc = new Array("_t", "_s", "_c");
		var ryb = new Array("_r", "_y", "_b");
		// 중복 체크
		var temp = new Array();
		$("._x").each(function() {
			var v, v1, v2, v3;
			do {
				// 랜덤 생성
				v1 = Math.floor(Math.random() * 3);
				v2 = Math.floor(Math.random() * 3);
				v3 = Math.floor(Math.random() * 3);
				v = v1 * 9 + v2 * 3 + v3;
			} while (temp[v] == true);
			// 중복 방지
			temp[v] = true;
			// 조합 부여
			$(this).removeClass("_w _g _k").addClass(wgk[v1]).attr("data-value", v);
			$(this).children("._shape").removeClass("_t _s _c _r _y _b").addClass(tsc[v2]).addClass(ryb[v3]);
		});
		// 합!
		for(var a = 0; a < 9 - 2; a++) {
			for(var b = a + 1; b < 9 - 1; b++) {
				for(var c = b + 1; c < 9; c++) {
					var v1 = $("._x").eq(a).attr("data-value");
					var v2 = $("._x").eq(b).attr("data-value");
					var v3 = $("._x").eq(c).attr("data-value");
					if(combi_check(v1, v2, v3)) {
						answer.push("" + (a + 1) + (b + 1) + (c + 1));
					}
				}
			}
		}
	}

	function combi_check(v1, v2, v3) {
		// 배경색
		var b1 = Math.floor(v1 / 9);
		var b2 = Math.floor(v2 / 9);
		var b3 = Math.floor(v3 / 9);
		// 모양
		var s1 = Math.floor(v1 % 9 / 3);
		var s2 = Math.floor(v2 % 9 / 3);
		var s3 = Math.floor(v3 % 9 / 3);
		// 색
		var c1 = v1 % 3;
		var c2 = v2 % 3;
		var c3 = v3 % 3;

		if(((b1 == b2 && b2 == b3 && b3 == b1) || (b1 != b2 && b2 != b3 && b3 != b1)) && ((s1 == s2 && s2 == s3 && s3 == s1) || (s1 != s2 && s2 != s3 && s3 != s1)) && ((c1 == c2 && c2 == c3 && c3 == c1) || (c1 != c2 && c2 != c3 && c3 != c1))) {
			return true;
		} else {
			return false;
		}
	}

	function clear() {
		setTimeout(function() {
			$("._combi").removeClass("_a _m");
			$("._comp").removeClass("_a _m");
			$("._selected").removeClass("_a _m _selected");
		}, 1000);
	}
</script>
